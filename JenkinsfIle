pipeline {
  agent {
    label 'ETQA-MAC2'
  }

   arameters {
      choice(name:'environment',choices:['QA','STG','LIVE'],description:'')
   }

  stages {
    stage('build and test') {

      steps {
        sh 'npm --version'
        script {
          case_tag = "${params.environment}".toLowerCase()
          sh 'yarn install --frozen-lockfile'
          sh 'yarn cypress:run --browser chrome --env testEnv=${case_tag}  --spec "cypress/integration/e2e/*"'
          junit 'results/test-results.xml'
         }
      }
    }
  }
}